import * as React from "react";
import useSWR from "swr";
import Image from "next/image";

export const Images = ({ loading }: { loading: boolean }) => {
  console.log("app/components/Images");

  const { data } = useSWR<{ Key?: string }[]>(
    "/api/documents",
    async (path: string) => {
      console.log("fetch(", path, ")");
      const f = await fetch(path).then((res) => res.json());
      console.log("f:", f);
      return f;
    }
  );
  const audios = data?.filter(
    (image) =>
      typeof image.Key == "string" &&
      image.Key != "" &&
      !/\//.test(image.Key) &&
      /\.wav/.test(image.Key)
  );
  const images = data?.filter(
    (image) =>
      typeof image.Key == "string" &&
      image.Key != "" &&
      !/\//.test(image.Key) &&
      !/\.wav/.test(image.Key)
  );
  return (
    <>
      {images && (
        <>
          <h2 className="w-full text-center text-2xl font-bold p-4">Images</h2>
          <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
            {images.map((image, imageIdx) => (
              <S3Image
                Key={image?.Key ? image.Key : "p" + imageIdx}
                key={image?.Key ? image.Key : "p" + imageIdx}
              />
            ))}
          </div>
        </>
      )}
      {audios && (
        <>
          <h2 className="w-full text-center text-2xl font-bold p-4">Audios</h2>
          <div id="audios" className="grid grid-cols-2 md:grid-cols-3 gap-4">
            {audios.map((image, imageIdx) => (
              <figure key={image.Key}>
                <figcaption>Listen to {image.Key?.slice(10, 20)}:</figcaption>
                <audio controls src={image.Key}></audio>
                <a href={image.Key}> Download audio </a>
              </figure>
            ))}
          </div>
        </>
      )}
    </>
  );
};

const S3Image = ({ Key }: { Key: string }) => {
  const [dd, setDD] = React.useState<string | null>(null);
  React.useEffect(() => {
    async function bo() {
      const da = await fetch(`/api/documents/${Key}`);
      const data = await da.json();
      setDD(data.src);
    }
    bo();
  }, [Key]);
  return dd ? (
    <div
      key={Key}
      className="h-auto max-w-full rounded-lg bg-slate-100 justify-center items-center flex p-4"
    >
      <Image
        placeholder="blur"
        blurDataURL="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4gHYSUNDX1BST0ZJTEUAAQEAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADb/2wBDABQODxIPDRQSEBIXFRQYHjIhHhwcHj0sLiQySUBMS0dARkVQWnNiUFVtVkVGZIhlbXd7gYKBTmCNl4x9lnN+gXz/2wBDARUXFx4aHjshITt8U0ZTfHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHz/wAARCATLAvIDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAECBv/EABQQAQAAAAAAAAAAAAAAAAAAAAD/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhEDEQA/AOMAAAAAAAAABQAAAUABUUAABUUAABUUAAAAAAAAABVAAAEABQABAAAAQAABBAAAAQAAAAAQRUAAAAAAAAAAAAAAAVFAAAAAAAAAVFAAAAAABkAAAAAAAAAFAAABQAFRQAAFRQAAFRQAAAAABQAQAVQAABAAUAAQAAAEAQAAQAAAEAAAAAEEVAAAAAAAAAAAAAAAAAUAAAAAAABUUAAAAAAGQAAAAAAAAAUAAAFAAVFAAAVFAAAVFAAAAAAFABABVAAAAAAAAQAAEAAAAQQAAAEAAAAAEEVAAAAAAAAAAAAAAAAAUAAAAAAABUUAAAAAAGQAAAAAAAAAUAAAFAAVFAAAVFAAAVFAAAAAAAAVQAABAAUAAEVAAAEVAAAAEEAAABAAAAABBFQAAAAAAAAAAAAAAAAFAAAAAAAAABQAAAAAZAAAAAAAAABQAAAUABUUAABUUAABUUAAAAAAAAUAAAAAUAAEVAAAEVAAEAAEAAABAAAAABBFQAAAAAAAAAAAAAAAAFAAAAAAAAABQAAAAAZAAAAAAAAABQAAAUABUUAABUUAABUUAAAAAAAAAAUAEAFUAARUAAARUAAQAAQAAAEAAAAAEEVAAAAAAAAAAAAAAAAAUAAAAAAAAAFAAAAABkAAAAAAAAAFAAABQAFRQAAFRQAAAAUAAAAAAAAAAAABVAAEVAAAEVAAEAEAAABAAAAAABBFQAAAAAAAAAAAAAAAAFAAAAAAAAABRFAAAABkAAAAAAAAAFAAAAVFAVAFAAVAFAAABQAAAAAAAAAAFUAQAFBAAAARUQAAEVAAAEVAAAABAABFQAAAAAAAAAAAAAAAAFAAAAAAAAAAVFAAAABkAAAAAAAAAFAAAAVFAABQAAAUAAAFEUAAAAAAAAAAUAAAUQAAABAAAQEVAAAEVAAAABAAEAAAAAAAAAAAAAAAAABQAAAAAAAAAFQBQAAAZAAAAAAAAABQAAAFRQAAUAAAFAAAAVFAAAAAAAAFAAAAAQABQABAAAEBFQAABFQAAAAQABAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAFEUAAGQAAAAAAAAAUAAABUUAAFAAABQAAAAAUAAAAAAAAAAAUQAAAAAQAAABFQAABAAAAAEAAQAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAAAAAAAAUAAABUUAAFEUAABUUAAAAFEUAAAAAAAAAEFAAAAAQAAAAEAAABAAAAABAAEAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAQAAAAAAAAAFEUAAAAFAAVFAAAVFAAAAAABQAAAAAAQUAEABQABFQAAAAEAAABAAAAABAEAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAQAAAAAAAAABUUAAAAFAAVFAAAABQAAAAAAAUQAAAAAAFAAAAQAAAAEAAABAAAAAABBFQAAAAAAAAAAAAAAAAAAFEUAAAAAAAAAAAAAAEAAAAAAAAAAVFAAAABQAAAUAAAFAAAAAAAAAAAAAAAFAAEVAAAAAEVAAAEVAAAABAABFQAAAAAAAAAAAAAAAAAABUUAAAAAAAAAAAAAAEAAAAAAAAAAVFAAAABQAAAUAAABUUAAAAAAAAAAAAAAAAVAAAAAAQAAABAAAEAAAAEAAAAAAAAAAAAAAAAAAABUUAAAAAAAAAAAAAAEAAAAAAAAAAVFAAAABRFAAAVFAAAABQAAAAAAAAAAAAAEAAAUAABAAAAAQAQAAAAABAAAAAAAAAAAAAAAAAAAAFRQAAAAAAAAAAAAAAQAAAAAAAAABUUAAAABUUAABUAUAAABUAUAAAAAAAAABAAAAAAAFEVAAAAQQAAAAAAABAAAAAAAAAAAAAAAAAAAAFRQAAAAAAAAAAAAAAQAAAAAAAAABUUAAAABUUAAAAFAAAAAAVAFAAAAAAQAAAAAAAAAQAAABFQAAAAAABFQAAAAAAAAAAAAAAAAAAAABUAUAAAAAAAAAAAAAEAAAAAAAAAAVFAAAAAVAFAAAAVFAAAAAAAVAFEAAAAAAAAAAAEVAAAAAQAAAAAAABFQAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAABAAAAAAAAAAFRQAAAAAAUAAAAAFAAAAAAAAAAAAAAAAAAABAAAAAQAAAAAAAABFQAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAABAAAAAAAAAAFRQAAAAAAURQAAAAFRQAAAAAAAAAAAAAAAAAQAAAABFQAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAQAAAAAAAAABUUAAAAAABUUAAAAAAFAAAAAAAAAAAAAAAAQAAAAAEAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAVFAAAAAAAAAAAABAAAAAAAAAAFRQAAAAAAFQBQAAAAAFQBQAAAAAAAAAAAAQAAAAAAEAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAFRQAAAAAAAAAAAAQAAAAAAAAAAAFAAAAAAABQAAAAAAAAAURQAAAAAAAQAAAAAABFQAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAVAFAAAAAAAAAAABAAAAAAAAAAAAUAAAAAAABUUAAAAAAAAAABUAUQBUAAAAAAAAAEAAAAAAAAAARUAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAQAAAAAAAAAAAFAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAABFQAAAAAAAAAAAAAAAAAAAAAAAAAAFEUAAAAAAAAAAEAAAAAAAAAAABQAAAAAAAAAFQBQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAVFAAAAAAAAAABAAAAAAAAAAAAURQAAAAAAAAAAURQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAQAAAAAAAAAAABUUAAAAAAAAAAAABUAUAAAAAAEBRAFQAAAAAAAAAAAAAAAEVAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAURQAAAAAAAAQAAAAAAAAAAABUUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVAFAAAAAAABAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABRFAAAAAABAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVAFAAAAABAAAAAAAAAAAAAAFRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABUAURQAAQAAAAAAAAAAAAABUAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABUUAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAEVAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFQBQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABUUAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVAFAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUQBRAFEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUEFAAAAAQUBBQEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQRQAAAAAAAAAAAAARQEFQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAABFAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAABBUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAEUBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEFQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAARQEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEVAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAARUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEVAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAABQAAAAAQAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAUAAAAAAAEAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQQUBAAAAAAAAAAAAAUAAAAAAAAAAAAAAABQAAAAAAAQAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAABAAAAAAAAAAAAFRQAAAAAAAAAAAAAAAFAAAAAAABAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAH/2Q=="
        width={100}
        height={100}
        key={Key}
        alt="asshoole"
        src={dd}
      />
    </div>
  ) : null;
};
